<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0a0a0f">
  <title>Cubby</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>


<body>

  <!-- Auth Screen -->
  <div id="auth-screen" class="screen active">
    <div class="auth-container">
      <div class="auth-logo">CUBBY</div>
      <h1 class="auth-title" id="auth-title">Welcome back</h1>

      <form id="auth-form" onsubmit="handleAuth(event)">
        <div class="auth-input-group">
          <input type="email" id="auth-email" placeholder="Email" required autocomplete="email">
        </div>
        <div class="auth-input-group">
          <input type="password" id="auth-password" placeholder="Password" required autocomplete="current-password">
        </div>
        <div class="auth-input-group" id="confirm-password-group" style="display: none;">
          <input type="password" id="auth-confirm-password" placeholder="Confirm password" autocomplete="new-password">
        </div>

        <div id="auth-error" class="auth-error"></div>

        <button type="submit" class="auth-btn" id="auth-submit-btn">Sign In</button>
      </form>

      <p class="auth-switch">
        <span id="auth-switch-text">Don't have an account?</span>
        <button type="button" class="auth-switch-btn" onclick="toggleAuthMode()">Sign Up</button>
      </p>
    </div>
  </div>

  <!-- Sidebar (desktop: always visible, mobile: slide-out overlay) -->
  <div id="sidebar-overlay" class="sidebar-overlay" onclick="closeMobileSidebar()"></div>
  <aside id="app-sidebar" class="app-sidebar" style="display: none;">
    <div class="sidebar-header">
      <div class="sidebar-logo">CUBBY</div>
      <button class="sidebar-close-btn" onclick="closeMobileSidebar()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>

    <nav class="sidebar-nav">
      <button class="sidebar-nav-item" data-sidebar-tab="home" onclick="goToHome(); closeMobileSidebar();">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span>Home</span>
      </button>
      <button class="sidebar-nav-item" data-sidebar-tab="views" onclick="openViews(); closeMobileSidebar();">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
        <span>Tasks</span>
      </button>
      <button class="sidebar-nav-item" data-sidebar-tab="cubbies" onclick="openCubbiesBrowse(); closeMobileSidebar();">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
        <span>Cubbies</span>
      </button>
      <button class="sidebar-nav-item" data-sidebar-tab="search" onclick="openSearchModal(); closeMobileSidebar();">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <span>Search</span>
      </button>
    </nav>

    <div class="sidebar-divider"></div>

    <div class="sidebar-section-label">
      <span>workspaces</span>
      <button class="sidebar-add-workspace-btn" onclick="openNewRoomModal(); closeMobileSidebar();" title="New workspace">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
    </div>
    <div class="sidebar-workspaces" id="sidebar-workspaces">
      <!-- Rendered by JS -->
    </div>

    <div class="sidebar-bottom">
      <button class="sidebar-nav-item sidebar-new-btn" onclick="openModalFromNavBar(); closeMobileSidebar();">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        <span>New Task</span>
      </button>
      <div class="sidebar-divider"></div>
      <div class="sidebar-user-row" onclick="openSettings(); closeMobileSidebar();">
        <div class="sidebar-user-avatar" id="sidebar-user-avatar">?</div>
        <span class="sidebar-user-name" id="sidebar-user-name">user</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      </div>
    </div>
  </aside>

  <!-- Home Screen -->
  <div id="home-screen" class="screen">
    <div class="home-header animate-in">
      <div class="greeting">
        <h1 id="greeting-text">Hello!</h1>
        <p id="greeting-date"></p>
      </div>
      <div class="home-header-actions">
        <button type="button" class="home-edit-btn" onclick="toggleHomeEditMode()" title="Customize home">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
        </button>
        <button type="button" class="signout-btn" onclick="handleSignOut()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        </button>
      </div>
    </div>
    <button class="search-btn animate-in delay-1" onclick="openSearchModal()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      <span>Search tasks...</span>
      <span class="search-shortcut">âŒ˜K</span>
    </button>
    <div id="home-sections-container">
      <div class="home-section-wrapper" data-section-id="stats">
        <div id="dashboard-stats" class="dashboard-stats animate-in delay-1"></div>
      </div>
      <div class="home-widget-grid">
        <div class="home-section-wrapper home-widget-card" data-section-id="upcoming">
          <div class="widget-card-header desktop-only">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span>upcoming tasks</span>
          </div>
          <div id="dashboard-upcoming" class="dashboard-upcoming animate-in delay-2"></div>
        </div>
        <div class="home-section-wrapper home-widget-card" data-section-id="quick-actions">
          <div class="widget-card-header desktop-only">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
            <span>quick actions</span>
          </div>
          <div class="dashboard-quick-actions animate-in delay-2">
            <button class="quick-action-btn" onclick="openModalFromNavBar()">
              <div class="quick-action-icon" style="background: rgba(107, 245, 160, 0.15); color: #6bf5a0;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              </div>
              <span>new task</span>
            </button>
            <button class="quick-action-btn" onclick="openNewCubbyModal()">
              <div class="quick-action-icon" style="background: rgba(199, 125, 255, 0.15); color: #c77dff;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="4"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
              </div>
              <span>new cubby</span>
            </button>
            <button class="quick-action-btn" onclick="openNewRoomModal()">
              <div class="quick-action-icon" style="background: rgba(107, 163, 255, 0.15); color: #6ba3ff;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
              </div>
              <span>new workspace</span>
            </button>
            <button class="quick-action-btn" onclick="openViews()">
              <div class="quick-action-icon" style="background: rgba(254, 202, 87, 0.15); color: #feca57;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
              </div>
              <span>all tasks</span>
            </button>
          </div>
        </div>
      </div>
      <div class="home-section-wrapper" data-section-id="workspaces">
        <div class="dashboard-section-label animate-in delay-3">workspaces</div>
        <div id="rooms-container"></div>
      </div>
    </div>
    <div class="logo animate-in delay-3"><span>CUBBY</span><span class="version">v1.5.2</span></div>
  </div>

  <!-- Views Screen -->
  <div id="views-screen" class="screen">
    <div class="header animate-in">
      <button class="back-btn" onclick="goToHome()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18L9 12L15 6"/></svg>
        back
      </button>
      <div class="view-mode-toggle" id="view-mode-toggle">
        <button class="view-mode-btn active" data-mode="due-date" onclick="setViewColorMode('due-date')">Color by Due Date</button>
        <button class="view-mode-btn" data-mode="cubby" onclick="setViewColorMode('cubby')">Color by Cubby</button>
      </div>
    </div>
    <div class="views-title animate-in delay-1"><h1>Tasks</h1></div>
    <div id="views-container" class="views-container"></div>
  </div>

  <!-- Cubbies Browse Screen -->
  <div id="cubbies-screen" class="screen">
    <div class="cubbies-browse-title animate-in"><h1>cubbies</h1></div>
    <div id="cubbies-browse-container" class="cubbies-browse-container"></div>
  </div>
  
  <!-- Room Screen -->
  <div id="room-screen" class="screen">
    <div class="header animate-in">
      <button class="back-btn" onclick="goToHome()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18L9 12L15 6"/></svg>
        back
      </button>
      <button class="header-search-btn" onclick="openSearchModal()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      </button>
    </div>
    <div id="room-title" class="room-title animate-in delay-1"></div>
    <div id="cubbies-list" class="cubbies-list"></div>
  </div>
  
  <!-- Cubby Screen -->
  <div id="cubby-screen" class="screen">
    <div class="cubby-header animate-in">
      <button class="back-btn" onclick="goToRoom()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18L9 12L15 6"/></svg>
        back
      </button>
      <button class="header-search-btn" onclick="openSearchModal()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      </button>
      <button class="cubby-settings-btn" onclick="openCubbySettingsMenu(event)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      </button>
      <button id="cubby-date-toggle" class="cubby-date-toggle" onclick="toggleCubbyDateColorMode()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
      </button>
      <button class="new-task-btn" onclick="openModalForFirstSubcubby()">
        <span class="plus">+</span>
        <span class="text">new task</span>
      </button>
    </div>

    <div id="cubby-title" class="cubby-title animate-in delay-1"></div>

    <div id="tasks-container" class="tasks-container"></div>
  </div>

  <!-- Settings Screen -->
  <div id="settings-screen" class="screen">
    <div class="header animate-in">
      <button class="back-btn" onclick="goToHome()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18L9 12L15 6"/></svg>
        back
      </button>
    </div>
    <div class="settings-title animate-in delay-1"><h1>Settings</h1></div>
    <div id="settings-container" class="settings-container"></div>
  </div>

  <!-- Archive Screen -->
  <div id="archive-screen" class="screen">
    <div class="header animate-in">
      <button class="back-btn" onclick="openSettings()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18L9 12L15 6"/></svg>
        back
      </button>
    </div>
    <div class="settings-title animate-in delay-1"><h1>Archive</h1></div>
    <div id="archive-container" class="archive-container"></div>
  </div>

  <!-- Trash Screen -->
  <div id="trash-screen" class="screen">
    <div class="header animate-in">
      <button class="back-btn" onclick="openArchive()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18L9 12L15 6"/></svg>
        back
      </button>
    </div>
    <div class="settings-title animate-in delay-1"><h1>Trash</h1></div>
    <div id="trash-container" class="trash-container"></div>
  </div>

  <!-- Bottom Navigation Bar (mobile only) -->
  <nav id="bottom-nav" class="bottom-nav" style="display: none;">
    <button class="nav-tab nav-tab-home" data-tab="home" onclick="goToHome()">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <span>Home</span>
    </button>
    <button class="nav-tab nav-tab-views" data-tab="views" onclick="openViews()">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
      <span>Tasks</span>
    </button>
    <button class="nav-tab nav-tab-add" onclick="openModalFromNavBar()">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      <span>New</span>
    </button>
    <button class="nav-tab nav-tab-cubbies" data-tab="cubbies" onclick="openCubbiesBrowse()">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
      <span>Cubbies</span>
    </button>
    <button class="nav-tab nav-tab-menu" onclick="toggleMobileSidebar()">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      <span>Menu</span>
    </button>
  </nav>

  <!--
    Script Loading Order:
    1. app.js - Core data structures, localStorage, navigation, colors (loads data)
    2. animations.js - FLIP animations (no dependencies except app.js variables)
    3. drag.js - Drag & drop reordering system (depends on app.js variables)
    4. render.js - All render functions (depends on app.js variables)
    5. tasks.js - Task CRUD operations (depends on app.js, render.js, animations.js)
    6. modals.js - Modal handling (depends on app.js, render.js, tasks.js)
    7. menus.js - Kebab menus (depends on all above)
    8. search.js - Search functionality
  -->
  <script src="supabase.js"></script>
  <script src="sync.js"></script>
  <script src="app.js"></script>
  <script src="animations.js"></script>
  <script src="drag.js"></script>
  <script src="render.js"></script>
  <script src="tasks.js"></script>
  <script src="modals.js"></script>
  <script src="menus.js"></script>
  <script src="search.js"></script>
  <script src="views.js"></script>
  <script src="settings.js"></script>
  <script>
    // App initialization is now handled by checkAuthState() in supabase.js
    // It checks if user is logged in and shows the appropriate screen
  </script>
  
</body>
</html>
